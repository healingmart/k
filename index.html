400 ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë³´ë‹ˆ `detailCommon` operationì´ ì„œë²„ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì„œë²„ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

## **api/lib/client.js ìˆ˜ì • (detailCommon íŒŒë¼ë¯¸í„° ìˆ˜ì •)**

```javascript
/**
 * ê´€ê´‘ API í´ë¼ì´ì–¸íŠ¸
 */

const { CONFIG, API_ERROR_CODES } = require('./config');
const { sanitizeInput, safeParseFloat, safeParseInt } = require('./security');

// ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ìºì‹œ
const cache = new Map();

/**
 * ìºì‹œ ì •ë¦¬
 */
function cleanupCache() {
  const now = Date.now();
  for (const [key, data] of cache.entries()) {
    if (now > data.expiry) {
      cache.delete(key);
    }
  }
  
  if (cache.size > CONFIG.MAX_CACHE_SIZE) {
    const entries = Array.from(cache.entries());
    entries.sort((a, b) => a[1].timestamp - b[1].timestamp);
    cache.delete(entries[0][0]);
  }
}

/**
 * API ì—ëŸ¬ í´ë˜ìŠ¤
 */
class ApiError extends Error {
  constructor(message, code = 'API_ERROR', statusCode = 500, details = {}) {
    super(message);
    this.name = 'ApiError';
    this.code = code;
    this.statusCode = statusCode;
    this.details = details;
    this.timestamp = new Date().toISOString();
  }
  
  toJSON() {
    return {
      success: false,
      error: {
        name: this.name,
        code: this.code,
        message: this.message,
        statusCode: this.statusCode,
        details: this.details,
        timestamp: this.timestamp
      }
    };
  }
}

/**
 * ê´€ê´‘ API í´ë¼ì´ì–¸íŠ¸
 */
class TourismApiClient {
  constructor() {
    // í™˜ê²½ë³€ìˆ˜ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
    this.apiKey = process.env.TOURISM_API_KEY;
    
    if (!this.apiKey) {
      throw new ApiError(
        'TOURISM_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
        'MISSING_API_KEY',
        500
      );
    }
    
    this.baseURL = CONFIG.API_BASE_URL;
  }
  
  /**
   * ê¸°ë³¸ íŒŒë¼ë¯¸í„°
   */
  buildBaseParams(params = {}) {
    return {
      serviceKey: this.apiKey,
      MobileOS: 'ETC',
      MobileApp: 'TourismAPI',
      _type: 'json',
      ...params
    };
  }
  
  /**
   * ìºì‹œ í‚¤ ìƒì„±
   */
  generateCacheKey(operation, params) {
    const sortedParams = Object.keys(params).sort().reduce((result, key) => {
      result[key] = params[key];
      return result;
    }, {});
    return `${operation}:${JSON.stringify(sortedParams)}`;
  }
  
  /**
   * API ìš”ì²­ ì‹¤í–‰
   */
  async makeRequest(endpoint, params = {}, operation = 'unknown') {
    const fullParams = this.buildBaseParams(params);
    const cacheKey = this.generateCacheKey(operation, fullParams);
    
    // ìºì‹œ í™•ì¸
    const cached = cache.get(cacheKey);
    if (cached && Date.now() < cached.expiry) {
      return cached.data;
    }
    
    // ìºì‹œ ì •ë¦¬
    if (cache.size > CONFIG.MAX_CACHE_SIZE) {
      cleanupCache();
    }
    
    // URL ìƒì„±
    const queryString = new URLSearchParams(fullParams).toString();
    const url = `${this.baseURL}${endpoint}?${queryString}`;
    
    try {
      // API í˜¸ì¶œ
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), CONFIG.REQUEST_TIMEOUT);
      
      const response = await fetch(url, {
        method: 'GET',
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        throw new ApiError(
          `API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`,
          'HTTP_ERROR',
          response.status
        );
      }
      
      const data = await response.json();
      
      // API ì‘ë‹µ ê²€ì¦
      if (data.response?.header?.resultCode !== '0000') {
        const resultCode = data.response?.header?.resultCode || '99';
        const errorCode = API_ERROR_CODES[resultCode] || 'API_ERROR';
        throw new ApiError(
          data.response?.header?.resultMsg || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜',
          errorCode,
          400,
          { resultCode, resultMsg: data.response?.header?.resultMsg }
        );
      }
      
      // ì„±ê³µ ì‘ë‹µ ì²˜ë¦¬
      const result = data.response?.body || data;
      
      // ìºì‹œ ì €ì¥
      cache.set(cacheKey, {
        data: result,
        expiry: Date.now() + CONFIG.CACHE_TTL,
        timestamp: Date.now()
      });
      
      return result;
      
    } catch (error) {
      if (error.name === 'AbortError') {
        throw new ApiError('API ìš”ì²­ ì‹œê°„ ì´ˆê³¼', 'TIMEOUT', 504);
      }
      if (error instanceof ApiError) {
        throw error;
      }
      throw new ApiError(
        `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`,
        'NETWORK_ERROR',
        500,
        { originalError: error.message }
      );
    }
  }
  
  /**
   * ì§€ì—­ ê¸°ë°˜ ê´€ê´‘ì •ë³´ ì¡°íšŒ
   */
  async areaBasedList(params = {}) {
    const validatedParams = {
      numOfRows: safeParseInt(params.numOfRows, 10),
      pageNo: safeParseInt(params.pageNo, 1),
      ...params
    };
    
    return this.makeRequest('/areaBasedList2', validatedParams, 'areaBasedList');
  }
  
  /**
   * ìƒì„¸ ì •ë³´ ì¡°íšŒ
   */
  async detailCommon(params = {}) {
    if (!params.contentId) {
      throw new ApiError('contentIdëŠ” í•„ìˆ˜ íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.', 'VALIDATION_ERROR', 400);
    }
    
    // íŒŒë¼ë¯¸í„° ì •ë¦¬ - ë¶ˆí•„ìš”í•œ íŒŒë¼ë¯¸í„° ì œê±°
    const validatedParams = {
      contentId: params.contentId,
      contentTypeId: params.contentTypeId,
      defaultYN: params.defaultYN || 'Y',
      firstImageYN: params.firstImageYN || 'Y',
      areacodeYN: params.areacodeYN || 'Y',
      catcodeYN: params.catcodeYN || 'Y',
      addrinfoYN: params.addrinfoYN || 'Y',
      mapinfoYN: params.mapinfoYN || 'Y',
      overviewYN: params.overviewYN || 'Y'
    };
    
    return this.makeRequest('/detailCommon2', validatedParams, 'detailCommon');
  }
  
  /**
   * í‚¤ì›Œë“œ ê²€ìƒ‰
   */
  async searchKeyword(params = {}) {
    if (!params.keyword) {
      throw new ApiError('keywordëŠ” í•„ìˆ˜ íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.', 'VALIDATION_ERROR', 400);
    }
    
    const validatedParams = {
      numOfRows: safeParseInt(params.numOfRows, 10),
      pageNo: safeParseInt(params.pageNo, 1),
      keyword: sanitizeInput(params.keyword, 100),
      ...params
    };
    
    return this.makeRequest('/searchKeyword2', validatedParams, 'searchKeyword');
  }
  
  /**
   * ìœ„ì¹˜ ê¸°ë°˜ ê´€ê´‘ì •ë³´ ì¡°íšŒ
   */
  async locationBasedList(params = {}) {
    if (!params.mapX || !params.mapY) {
      throw new ApiError('mapXì™€ mapYëŠ” í•„ìˆ˜ íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.', 'VALIDATION_ERROR', 400);
    }
    
    const lat = safeParseFloat(params.mapY);
    const lng = safeParseFloat(params.mapX);
    
    if (isNaN(lat) || isNaN(lng)) {
      throw new ApiError('ìœ íš¨í•˜ì§€ ì•Šì€ ì¢Œí‘œê°’ì…ë‹ˆë‹¤.', 'VALIDATION_ERROR', 400);
    }
    
    // í•œêµ­ ì¢Œí‘œ ë²”ìœ„ ê²€ì¦
    if (lat < 33 || lat > 43 || lng < 124 || lng > 132) {
      throw new ApiError(
        `ì¢Œí‘œê°’ì´ í•œêµ­ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤. (ìœ„ë„: ${lat}, ê²½ë„: ${lng})`,
        'VALIDATION_ERROR',
        400
      );
    }
    
    const validatedParams = {
      numOfRows: safeParseInt(params.numOfRows, 10),
      pageNo: safeParseInt(params.pageNo, 1),
      mapX: lng,
      mapY: lat,
      radius: safeParseInt(params.radius, 1000),
      ...params
    };
    
    const result = await this.makeRequest('/locationBasedList2', validatedParams, 'locationBasedList');
    
    // ê±°ë¦¬ ì •ë³´ ì¶”ê°€ (ì„ íƒì‚¬í•­)
    if (params.addDistance === 'Y' && result.items?.item) {
      const items = Array.isArray(result.items.item) ? result.items.item : [result.items.item];
      
      result.items.item = items.map(item => {
        const itemLat = safeParseFloat(item.mapy);
        const itemLng = safeParseFloat(item.mapx);
        
        if (!isNaN(itemLat) && !isNaN(itemLng)) {
          const distance = this.calculateDistance(lat, lng, itemLat, itemLng);
          return { ...item, distance };
        }
        
        return item;
      }).sort((a, b) => (a.distance || 999999) - (b.distance || 999999));
    }
    
    return result;
  }
  
  /**
   * ê±°ë¦¬ ê³„ì‚° (ë¯¸í„° ë‹¨ìœ„)
   */
  calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
    const Ï†1 = (lat1 * Math.PI) / 180;
    const Ï†2 = (lat2 * Math.PI) / 180;
    const Î”Ï† = ((lat2 - lat1) * Math.PI) / 180;
    const Î”Î» = ((lon2 - lon1) * Math.PI) / 180;
    
    const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
              Math.cos(Ï†1) * Math.cos(Ï†2) *
              Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    
    return Math.round(R * c);
  }
}

/**
 * Rate Limiter
 */
const rateLimitMap = new Map();

function checkRateLimit(identifier) {
  const now = Date.now();
  const windowStart = now - CONFIG.RATE_LIMIT_WINDOW;
  
  const requests = rateLimitMap.get(identifier) || [];
  const validRequests = requests.filter(time => time > windowStart);
  
  if (validRequests.length >= CONFIG.RATE_LIMIT_MAX) {
    return {
      allowed: false,
      remaining: 0,
      resetTime: new Date(validRequests[0] + CONFIG.RATE_LIMIT_WINDOW).toISOString()
    };
  }
  
  validRequests.push(now);
  rateLimitMap.set(identifier, validRequests);
  
  // ë©”ëª¨ë¦¬ ì •ë¦¬
  if (rateLimitMap.size > 1000) {
    for (const [key, reqs] of rateLimitMap.entries()) {
      if (reqs.length === 0 || reqs[reqs.length - 1] < windowStart) {
        rateLimitMap.delete(key);
      }
    }
  }
  
  return {
    allowed: true,
    remaining: CONFIG.RATE_LIMIT_MAX - validRequests.length
  };
}

module.exports = {
  TourismApiClient,
  ApiError,
  checkRateLimit
};
```

ì„œë²„ ì½”ë“œë¥¼ ìˆ˜ì •í•œ í›„ ì¬ë°°í¬í•˜ê³ , ê·¸ ë™ì•ˆ HTMLì˜ ìƒì„¸ ì •ë³´ ë¶€ë¶„ì„ ê°„ë‹¨í•˜ê²Œ ìˆ˜ì •í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”:

## **ìˆ˜ì •ëœ HTML (ìƒì„¸ ì •ë³´ ê°„ì†Œí™”)**

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ê´‘ì§€ íƒìƒ‰ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        /* ê²€ìƒ‰ ì˜ì—­ */
        .search-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .search-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-group input, .search-group select {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            min-width: 150px;
        }
        
        .search-group button {
            padding: 12px 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .search-group button:hover {
            background: #0056b3;
        }
        
        .search-group button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
        }
        
        /* ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }
        
        .no-image {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 48px;
        }
        
        .card-content {
            padding: 15px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .card-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .card-distance {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .card-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            text-decoration: none;
            color: white;
        }
        
        .btn-map {
            background: #4CAF50;
        }
        
        .btn-detail {
            background: #2196F3;
        }
        
        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ìˆ˜ë™ ì…ë ¥ ì˜ì—­ */
        details {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        summary {
            cursor: pointer;
            font-weight: bold;
            color: #666;
        }
        
        .manual-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .manual-input input {
            flex: 1;
            min-width: 120px;
        }
        
        /* ë””ë²„ê·¸ ì •ë³´ */
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            margin-top: 10px;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ ëŒ€í•œë¯¼êµ­ ê´€ê´‘ì§€ íƒìƒ‰ê¸°</h1>
        
        <div class="search-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('keyword')">í‚¤ì›Œë“œ ê²€ìƒ‰</button>
                <button class="tab" onclick="switchTab('location')">ë‚´ ì£¼ë³€</button>
                <button class="tab" onclick="switchTab('area')">ì§€ì—­ë³„</button>
            </div>
            
            <!-- í‚¤ì›Œë“œ ê²€ìƒ‰ -->
            <div id="keyword-search" class="search-group">
                <input type="text" id="keyword" placeholder="ê´€ê´‘ì§€ ê²€ìƒ‰ (ì˜ˆ: ê²½ë³µê¶, í•´ìˆ˜ìš•ì¥)" value="ì œì£¼">
                <button onclick="searchByKeyword()">ê²€ìƒ‰</button>
            </div>
            
            <!-- ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰ -->
            <div id="location-search" class="search-group" style="display:none;">
                <button onclick="getMyLocation()">ğŸ“ ë‚´ ìœ„ì¹˜ ì°¾ê¸°</button>
                <input type="number" id="radius" placeholder="ë°˜ê²½(m)" value="5000" min="1000" max="20000">
                <button onclick="searchNearby()">ì£¼ë³€ ê²€ìƒ‰</button>
                
                <details style="width: 100%;">
                    <summary>ìˆ˜ë™ ì¢Œí‘œ ì…ë ¥ / í…ŒìŠ¤íŠ¸ ìœ„ì¹˜</summary>
                    <div class="manual-input">
                        <input type="text" id="manual-lat" placeholder="ìœ„ë„ (ì˜ˆ: 37.5665)">
                        <input type="text" id="manual-lng" placeholder="ê²½ë„ (ì˜ˆ: 126.9780)">
                        <button onclick="setManualLocation()">ì¢Œí‘œ ì„¤ì •</button>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="setTestLocation('ì„œìš¸')">ğŸ“ ì„œìš¸ì‹œì²­</button>
                        <button onclick="setTestLocation('ë¶€ì‚°')">ğŸ“ ë¶€ì‚°ì—­</button>
                        <button onclick="setTestLocation('ì œì£¼')">ğŸ“ ì œì£¼ê³µí•­</button>
                    </div>
                    <div id="location-debug" class="debug-info" style="display:none;"></div>
                </details>
            </div>
            
            <!-- ì§€ì—­ë³„ ê²€ìƒ‰ -->
            <div id="area-search" class="search-group" style="display:none;">
                <select id="areaCode">
                    <option value="1">ì„œìš¸</option>
                    <option value="6">ë¶€ì‚°</option>
                    <option value="4">ëŒ€êµ¬</option>
                    <option value="2">ì¸ì²œ</option>
                    <option value="5">ê´‘ì£¼</option>
                    <option value="3">ëŒ€ì „</option>
                    <option value="7">ìš¸ì‚°</option>
                    <option value="8">ì„¸ì¢…</option>
                    <option value="31">ê²½ê¸°</option>
                    <option value="32">ê°•ì›</option>
                    <option value="33">ì¶©ë¶</option>
                    <option value="34">ì¶©ë‚¨</option>
                    <option value="35">ê²½ë¶</option>
                    <option value="36">ê²½ë‚¨</option>
                    <option value="37">ì „ë¶</option>
                    <option value="38">ì „ë‚¨</option>
                    <option value="39" selected>ì œì£¼</option>
                </select>
                <select id="contentType">
                    <option value="">ì „ì²´</option>
                    <option value="12">ê´€ê´‘ì§€</option>
                    <option value="14">ë¬¸í™”ì‹œì„¤</option>
                    <option value="15">ì¶•ì œ/ê³µì—°</option>
                    <option value="25">ì—¬í–‰ì½”ìŠ¤</option>
                    <option value="28">ë ˆí¬ì¸ </option>
                    <option value="32">ìˆ™ë°•</option>
                    <option value="38">ì‡¼í•‘</option>
                    <option value="39">ìŒì‹ì </option>
                </select>
                <button onclick="searchByArea()">ê²€ìƒ‰</button>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display:none;">
            <div class="spinner"></div>
            <p>ê²€ìƒ‰ ì¤‘...</p>
        </div>
        
        <div id="results" class="card-grid"></div>
    </div>
    
    <script>
        const API_URL = 'https://k-ivory.vercel.app/api/tourism';
        let currentTab = 'keyword';
        let userLocation = null;
        let currentItems = []; // í˜„ì¬ ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
        
        // íƒ­ ì „í™˜
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('keyword-search').style.display = tab === 'keyword' ? 'flex' : 'none';
            document.getElementById('location-search').style.display = tab === 'location' ? 'flex' : 'none';
            document.getElementById('area-search').style.display = tab === 'area' ? 'flex' : 'none';
        }
        
        // ë¡œë”© í‘œì‹œ
        function showLoading(show = true) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('results').style.display = show ? 'none' : 'grid';
        }
        
        // í‚¤ì›Œë“œ ê²€ìƒ‰
        async function searchByKeyword() {
            const keyword = document.getElementById('keyword').value;
            if (!keyword) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch(`${API_URL}?operation=searchKeyword&keyword=${encodeURIComponent(keyword)}&numOfRows=20`);
                const data = await response.json();
                
                if (data.success) {
                    currentItems = data.data.items?.item || [];
                    displayResults(currentItems);
                } else {
                    alert('ê²€ìƒ‰ ì‹¤íŒ¨: ' + data.error.message);
                }
            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // ë‚´ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        function getMyLocation() {
            if (!navigator.geolocation) {
                alert('ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                return;
            }
            
            const button = event.target;
            button.textContent = 'ğŸ“ ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...';
            button.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    updateLocationDebug();
                    alert(`ìœ„ì¹˜ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!\nìœ„ë„: ${userLocation.lat.toFixed(6)}\nê²½ë„: ${userLocation.lng.toFixed(6)}`);
                    
                    button.textContent = 'ğŸ“ ë‚´ ìœ„ì¹˜ ì°¾ê¸°';
                    button.disabled = false;
                },
                (error) => {
                    let errorMessage = 'ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    alert(errorMessage);
                    
                    button.textContent = 'ğŸ“ ë‚´ ìœ„ì¹˜ ì°¾ê¸°';
                    button.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        
        // ì£¼ë³€ ê²€ìƒ‰
        async function searchNearby() {
            if (!userLocation) {
                alert('ë¨¼ì € ë‚´ ìœ„ì¹˜ ì°¾ê¸°ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì¢Œí‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            const radius = document.getElementById('radius').value;
            
            console.log('ê²€ìƒ‰ íŒŒë¼ë¯¸í„°:', {
                mapX: userLocation.lng,
                mapY: userLocation.lat,
                radius: radius
            });
            
            showLoading(true);
            
            try {
                const url = `${API_URL}?operation=locationBasedList&mapX=${userLocation.lng}&mapY=${userLocation.lat}&radius=${radius}&numOfRows=20`;
                console.log('ìš”ì²­ URL:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                console.log('ì‘ë‹µ ë°ì´í„°:', data);
                
                if (data.success) {
                    const items = data.data.items?.item || [];
                    if (items.length === 0) {
                        alert(`ë°˜ê²½ ${radius}m ë‚´ì— ê´€ê´‘ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.\në°˜ê²½ì„ ëŠ˜ë ¤ë³´ì„¸ìš”.`);
                    } else {
                        // ê±°ë¦¬ ê³„ì‚° ì¶”ê°€
                        const itemsWithDistance = items.map(item => {
                            const itemLat = parseFloat(item.mapy);
                            const itemLng = parseFloat(item.mapx);
                            if (!isNaN(itemLat) && !isNaN(itemLng)) {
                                item.distance = calculateDistance(userLocation.lat, userLocation.lng, itemLat, itemLng);
                            }
                            return item;
                        }).sort((a, b) => (a.distance || 999999) - (b.distance || 999999));
                        
                        currentItems = itemsWithDistance;
                        displayResults(itemsWithDistance, true);
                    }
                } else {
                    alert('ê²€ìƒ‰ ì‹¤íŒ¨: ' + (data.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    console.error('API ì˜¤ë¥˜:', data.error);
                }
            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
            } finally {
                showLoading(false);
            }
        }
        
        // ìˆ˜ë™ ì¢Œí‘œ ì„¤ì •
        function setManualLocation() {
            const lat = parseFloat(document.getElementById('manual-lat').value);
            const lng = parseFloat(document.getElementById('manual-lng').value);
            
            if (isNaN(lat) || isNaN(lng)) {
                alert('ì˜¬ë°”ë¥¸ ì¢Œí‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            if (lat < 33 || lat > 43 || lng < 124 || lng > 132) {
                alert('í•œêµ­ ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ì¢Œí‘œì…ë‹ˆë‹¤\nìœ„ë„: 33~43\nê²½ë„: 124~132');
                return;
            }
            
            userLocation = { lat, lng };
            updateLocationDebug();
            alert(`ì¢Œí‘œê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!\nìœ„ë„: ${lat}\nê²½ë„: ${lng}`);
        }
        
        // í…ŒìŠ¤íŠ¸ ìœ„ì¹˜ ì„¤ì •
        function setTestLocation(city) {
            const locations = {
                'ì„œìš¸': { lat: 37.5665, lng: 126.9780, name: 'ì„œìš¸ì‹œì²­' },
                'ë¶€ì‚°': { lat: 35.1153, lng: 129.0413, name: 'ë¶€ì‚°ì—­' },
                'ì œì£¼': { lat: 33.5066, lng: 126.4926, name: 'ì œì£¼ê³µí•­' }
            };
            
            const loc = locations[city];
            userLocation = { lat: loc.lat, lng: loc.lng };
            
            document.getElementById('manual-lat').value = loc.lat;
            document.getElementById('manual-lng').value = loc.lng;
            
            updateLocationDebug();
            alert(`${loc.name} ì¢Œí‘œê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }
        
        // ìœ„ì¹˜ ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateLocationDebug() {
            if (userLocation) {
                const debugDiv = document.getElementById('location-debug');
                debugDiv.style.display = 'block';
                debugDiv.innerHTML = `
                    <strong>í˜„ì¬ ì„¤ì •ëœ ìœ„ì¹˜:</strong><br>
                    ìœ„ë„(lat/mapY): ${userLocation.lat}<br>
                    ê²½ë„(lng/mapX): ${userLocation.lng}<br>
                    <a href="https://map.kakao.com/link/map/ë‚´ìœ„ì¹˜,${userLocation.lat},${userLocation.lng}" target="_blank">ì¹´ì¹´ì˜¤ë§µì—ì„œ í™•ì¸</a>
                `;
            }
        }
        
        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI / 180;
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lon2 - lon1) * Math.PI / 180;
            
            const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            
            return Math.round(R * c); // ë¯¸í„° ë‹¨ìœ„
        }
        
        // ì§€ì—­ë³„ ê²€ìƒ‰
        async function searchByArea() {
            const areaCode = document.getElementById('areaCode').value;
            const contentType = document.getElementById('contentType').value;
            
            showLoading(true);
            
            try {
                let url = `${API_URL}?operation=areaBasedList&areaCode=${areaCode}&numOfRows=20`;
                if (contentType) {
                    url += `&contentTypeId=${contentType}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    currentItems = data.data.items?.item || [];
                    displayResults(currentItems);
                } else {
                    alert('ê²€ìƒ‰ ì‹¤íŒ¨: ' + data.error.message);
                }
            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ (ìƒì„¸ ì •ë³´ ì—†ì´)
        function displayResults(items, showDistance = false) {
            const resultsDiv = document.getElementById('results');
            
            if (!items || items.length === 0) {
                resultsDiv.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ë°°ì—´ì´ ì•„ë‹Œ ê²½ìš° ë°°ì—´ë¡œ ë³€í™˜
            if (!Array.isArray(items)) {
                items = [items];
            }
            
            resultsDiv.innerHTML = items.map((item, index) => `
                <div class="card" data-index="${index}">
                    ${item.firstimage ? 
                        `<img src="${item.firstimage}" alt="${item.title}" class="card-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                         <div class="no-image" style="display:none;">ğŸ“·</div>` : 
                        `<div class="card-image no-image">ğŸ“·</div>`
                    }
                    <div class="card-content">
                        <h3 class="card-title">${item.title}</h3>
                        <p class="card-info">ğŸ“ ${item.addr1 || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</p>
                        ${item.tel ? `<p class="card-info">ğŸ“ ${item.tel}</p>` : ''}
                        ${showDistance && item.distance ? 
                            `<span class="card-distance">${formatDistance(item.distance)}</span>` : ''
                        }
                        <div class="card-actions">
                            <a href="https://map.kakao.com/link/map/${item.title},${item.mapy},${item.mapx}" 
                               target="_blank" 
                               class="card-btn btn-map"
                               onclick="event.stopPropagation()">
                                ì§€ë„ë³´ê¸°
                            </a>
                            <a href="https://map.kakao.com/link/to/${item.title},${item.mapy},${item.mapx}" 
                               target="_blank" 
                               class="card-btn btn-detail"
                               onclick="event.stopPropagation()">
                                ê¸¸ì°¾ê¸°
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ê±°ë¦¬ í¬ë§·
        function formatDistance(meters) {
            if (meters < 1000) {
                return `${meters}m`;
            }
            return `${(meters / 1000).toFixed(1)}km`;
        }
        
        // ì—”í„°í‚¤ ì´ë²¤íŠ¸
        document.getElementById('keyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchByKeyword();
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì œì£¼ ê²€ìƒ‰
        window.addEventListener('load', function() {
            searchByKeyword();
        });
    </script>
</body>
</html>
```

ì´ì œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ ì—†ì´ ì¹´ë“œì—ì„œ ë°”ë¡œ ì§€ë„ë³´ê¸°ì™€ ê¸¸ì°¾ê¸°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤!
